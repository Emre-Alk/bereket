<div class="fixed top-0 inset-x-0 bg-neutral-100"> <!-- fixed top page start -->
  <div class="pt-4">
    <div class="flex flex-row justify-between items-center px-5 py-2">
      <p>ici mon logo</p>
      <!-- nav - start -->
      <div data-controller="navbar"> <!-- stimulus ctrl to toggle button -->
        <button data-action="click->navbar#toggle">
          <%= icon("fa-solid", "bars", class:"fa-lg")%>
        </button>
        <div>
          <%= render partial: "assos/navbar", locals: { asso: @my_asso, place: @my_place, donations: @donations, top_donators: @top_donators }%>
        </div>
      </div>
      <!-- nav - end -->
    </div>

    <% if @my_asso && @my_place %>
      <!-- card - start -->
      <div class="flex flex-row justify-center items-center gap-x-16 py-2">
        <div class="hidden"> <!-- stimulus controller to toggle this -->
          <%= icon("fa-solid", "chevron-left")%> <!-- add "unless @my_place.length == 1 -->
        </div>
        <div class="flex flex-col items-center text-sm">

          <% if @my_place.place_image.attached? %>
            <%= image_tag(@my_place.place_image, alt:"picture", class:"rounded-full size-20 mb-1") %>
          <% else %>
            <%= image_tag("default_avatar.png", alt:"picture", class:"rounded-full size-20 mb-1") %>
          <% end %>

          <p class="roboto-thin text-sm"><%= @my_place.name %></p>
          <p class="roboto-thin text-sm"><%= @my_place.street_no %> <%= @my_place.address %>, <%= @my_place.city %>, <%= @my_place.country %></p>
        </div>
        <div class="hidden">
          <%= icon("fa-solid", "chevron-right") %>
        </div>
      </div>
      <!-- card - end -->
    <% end %>
  </div>
</div> <!-- fixed top page end -->

<% if @my_asso && @my_place %>
  <div class="flex flex-col pt-48 gap-y-4"> <!-- scrolled page start -->
    <!-- total - start -->
    <div class="bg-white flex flex-col gap-y-4 divide-y justify-center items-center roboto-medium text-4xl py-2 sm:pr-4 rounded-lg shadow-[0_0_12px_1px_rgba(0,0,0,0.1)]">
      <!--
        <div>
          <%= number_to_currency(@sum.to_f / 100, unit: "€", format: "%n %u") %>
        </div>
      -->
      <div class="flex flex-col w-11/12 gap-y-4">

        <div class="flex flex-row w-full">

          <p class="text-base text-neutral-500 flex-auto w-fit"> Solde disponible </p>
          <button class="rounded-lg p-1 shadow-sm active:shadow-inner bg-neutral-100">
            <%= link_to new_assos_payout_path do %>
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 21 3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5" />
              </svg>
            <% end %>
          </button>

        </div>

        <div class="flex-auto w-fit self-center">
          <%= number_to_currency(@balance_available.to_f / 100, unit: '€', format: '%n %u', delimiter: ' ') %>
        </div>
      </div>

      <div class="flex flex-row w-11/12 gap-x-4 pt-1">
        <p class="text-sm text-neutral-500 flex-auto w-fit flex items-end">Solde à venir </p>
        <div class="flex-auto w-fit self-end text-lg text-right text-neutral-500">
          <%= number_to_currency(@balance_future.to_f / 100, unit: '€', format: '%n %u', delimiter: ' ') %>
        </div>
      </div>

    </div>
    <!-- total - end -->

    <!-- chart - start -->
    <div>
      <div class="roboto-thin text-slate-800 text-sm"><%= @start_month.strftime("%B") %></div>
      <div class="bg-white py-2 px-2 rounded-lg shadow-[0_0_12px_1px_rgba(0,0,0,0.1)]" data-controller="line-chart" data-line-chart-revenue-value= "<%= @revenue_per_day_current_month.to_json %>" data-line-chart-timeframe-value="<%= @array_complete_days_current_month.to_json %>">
        <div class="w-full">
          <canvas data-line-chart-target="revenueChart" id="revenueChart" aria-label="courbe" role="revenu" >
          </canvas>
        </div>
      </div>
    </div>
    <!-- chart - end -->

    <!-- top 10 donateur - start -->
    <div>
      <div class="roboto-thin text-slate-800 text-base">Top donateurs</div>
      <div class="bg-white flex flex-row justify-start items-center h-32 gap-x-2 p-1 rounded-lg overflow-x-auto text-center shadow-[0_0_12px_1px_rgba(0,0,0,0.1)]">
        <!--start-->
        <% @top_donators.first(10).each do |don| %>
          <div class="bg-white flex flex-col justify-evenly items-center gap-y-1 min-w-24 min-h-24">
            <% if don[0].profile_image.attached? %>
            <%= image_tag(don[0].profile_image, class:"size-14 rounded-full") %>
            <% else %>
            <%= image_tag("default_avatar.png", class:"size-14 rounded-full") %>
            <% end %>
            <p class="w-full text-sm text-wrap"><%= don[0].first_name %> <%= don[0].last_name %></p>
          </div>
        <% end %>
        <!--end-->
      </div>
    </div>
    <!-- top 10 donateur - end -->

    <!-- last 10 donations - start -->
    <div>
      <div class="roboto-thin text-slate-800 text-base">Derniers dons</div>
      <!-- h-dvh or h-40 or h-screen. A voir... -->
      <div class="bg-white flex flex-col min-h-24 gap-2 divide-y divide-black/30 rounded-lg p-2 overflow-y-auto shadow-[0_0_12px_1px_rgba(0,0,0,0.1)] shadow-black/10">
        <!--start-->
        <%= render partial: "shared/donations", locals: { donations: @sorted_donations, size: 10 } %>
        <!--end-->
      </div>
    </div>
    <!-- last 10 donations - end -->
  </div>
  <!-- scrolled page end -->
<% elsif @my_asso %>
  <div class= "mt-48 w-full">
    <%= render partial: "assos/places/form_place", locals: { place: @place } %>
  </div>
<% else %>
  <div class= "mt-48 w-full">
    <%= render partial: "form_asso", locals: { asso: @asso } %>
  </div>
<% end %>
