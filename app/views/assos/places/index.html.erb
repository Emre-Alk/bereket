<div class="mb-5">
  <%= link_to :back do %>
    <%= svg_tag('chevron_left', class:'size-6 stroke-2') %>
  <% end %>
</div>

<%# title %>
<div class="mb-5 flex flex-row justify-between items-center">
  <h1 class="font-medium">Mes Ã©tablissements</h1>
</div>

<%# container of place items %>
<div class="space-y-8">
  <% @donators_per_place.each do |place| %>
    <%= place[0].name %>
    <%= place[1] %>
    <% place[2].each do |donator, dons|%>
      <%= donator.first_name %>
      <%= dons.count %>
    <% end %>
  <% end %>

  <% @places.each do |place| %>
  <%# to be replace with partial place %>
    <%= link_to assos_place_path(place) do %>
      <div class="rounded-lg w-full shadow-[0_0_12px_1px_rgba(0,0,0,0.1)]">
        <%# quick stats %>
        <div class="flex flex-row justify-between items-center">
          <%# nbre dons %>
          <span><%= place.donations.count %> <%= place.donations.count <= 1 ? 'don' : 'dons' %></span>
          <%# total euros dons %>
          <span><%= number_to_currency(place.donations.sum(&:amount_net).fdiv(100), local: :fr, strip_insignificant_zeros: true) %></span>
          <%# nbr donator %>
          <span></span>
        </div>

        <%# image %>
        <div>
          <% if place.place_image.attached? %>
            <div class=" flex justify-center items-center h-28 w-full">
                <%= cl_image_tag(place.place_image.key, crop: 'fill', class:'h-28 w-full rounded-t-lg') %>
            </div>
          <% else %>
            <div class="flex justify-center items-center h-28 w-full rounded-t-lg bg-gray-300">
              <%= svg_tag('image_empty', class:'size-20 bg-inherit text-gray-200') %>
            </div>
          <% end %>
        </div>

        <%# quick recap %>
        <div class="relative rounded-b-lg text-sm flex flex-col gap-y-1 bg-white p-2">

          <div class="flex flex-row gap-4 items-baseline">
            <%= icon("fa-solid", "paper-plane") %>
            <%= place.name.titleize %>
          </div>

          <div class="flex flex-row gap-4 items-baseline">
            <%= icon("fa-solid", "location-dot") %>
            <%= place.street_no %> <%= place.address %>, <%= place.city %> <%= place.zip_code %>, <%= place.country %>
          </div>

        </div>
      </div>
    <% end %>
  <% end %>
</div>

<%# button add place %>
<div class="fixed bottom-0 inset-x-0 bg-neutral-100">
  <%= link_to new_assos_place_path, class: "mx-5 my-5 flex flex-row items-center justify-center gap-x-2 bg-black text-white px-5 py-2.5 rounded-lg" do %>
    <%= svg_tag('add', class:"size-6 stroke-2 border-2 border-black p-px rounded-md")%>
    <p>Ajouter un Ã©tablissement</p>
  <% end %>
</div>
