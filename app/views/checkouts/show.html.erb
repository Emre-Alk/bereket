<!--
 <%= JSON.parse(@checkout_session.to_json) %>
-->

<!--
 <div>
  <p> place receiving donation in DB: <%= @place %></p>
  <p> stripe account of the asso owning the place: <%= @connected_account %></p>
  <p> used payment method: <%= @pm %></p>
  <p> payment status: <%= @payment_status %></p>
  <p> customer stripe id: <%= @visitor_customer ? @visitor_customer.stripe_id : @donator.customer.stripe_id %></p>
  <p> Is registered donator ? <%= @donator.first_name == 'visiteur' ? 'false' : 'true' %></p>
  <p> donator name: <%= @donator.first_name %></p>
  <p> user is signed in? <%= user_signed_in? %></p>
 </div>
-->

<!--
  <div class="flex flex-col w-full rounded-lg px-4 py-8 shadow-[0_0_12px_1px_rgba(0,0,0,0.1)]">
    <div class="flex flex-row gap-x-2">
      <div class="flex-auto w-6/12 flex-col bg-pink-200"> 1er colonne message
        <p>don n¬∞<%= @checkout_session.payment_intent.id %></p>
        <p>Merci et F√©licitation.</p>
        <p>Vous venez d'accomplir une bonne action aujourd'hui.</p>
        <p>Message de <%= @place.name %> : "blaaaabllaaablaaaa"</p>
        <%# create an authentification box if "log in" or "sign up"
        with stimumus, dropdown the right form
        use devise partial maybe ? %>

        <% if @donator.first_name == 'visiteur' %>

          <p>Vous n'etes pas encore DoGooder üò≥ </p>
          <p>renseigner vos infos ci-dessous pour rejoindre la communaut√© DoGooder en 1 clic.</p>

          <%= render partial: "devise/registrations/edit"%>

        <% end %>

        <p>retrouver votre don ici: lien donation#show </p>
        <p>retrouver votre cerfa pour votre ici: lien vers cerfa</p>
      </div>

      <div class="flex-auto w-6/12 flex-col bg-green-200">2e colonne card info
        <%= image_tag @place.place_image if @place.place_image.attached? %>

        <p>A: <%= @place.name %></p>

        <p>Montant donn√©: <%= number_to_currency(@amount.to_f / 100, unit: '‚Ç¨', format: '%n %u', delimiter: ' ') %></p>

        <p> Montant pouvant √™tre d√©fiscalis√©: <%= number_to_currency(@amount_detaxed.to_f / 100, unit: '‚Ç¨', format: '%n %u', delimiter: ' ') %> </p>

        <p>Ce que votre don vous a vraiment co√ªt√©: <%= number_to_currency((@amount - @amount_detaxed).to_f / 100, unit: '‚Ç¨', format: '%n %u', delimiter: ' ') %> </p>

        <p><%= @checkout_session.payment_intent.payment_method.card.brand %></p>
        <p>****<%= @checkout_session.payment_intent.payment_method.card.last4 %></p>
      </div>

    </div>

  </div>
-->
  <%# scroll page %>
<div class="pb-36 flex flex-col gap-y-5">

  <%# icon check %>
  <div class="rounded-lg flex flex-col py-4 items-center justify-center bg-black">
    <div>
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor" class="size-20 text-white dark:text-white">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
      </svg>
    </div>

    <div>
      <%# message DoGood (How does it feel to have accomplish a good deed today ? Good right !) %>
    </div>
  </div>

  <%# card place %>
  <div class="rounded-lg w-full shadow-[0_0_12px_1px_rgba(0,0,0,0.1)]">
    <%# image %>
    <% if @place.place_image.attached? %>
      <img src="<%= @place.place_image %>" class="rounded-t-lg h-28 w-full object-cover object-center" alt="image of the place">
    <% else %>
      <div class="rounded-t-lg flex justify-center items-center h-28 w-full bg-gray-300">
        <svg class="size-20 bg-inherit text-gray-200" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="m3 16 5-7 6 6.5m6.5 2.5L16 13l-4.286 6M14 10h.01M4 19h16a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1Z"/>
        </svg>
      </div>
    <% end %>

    <%# quick recap %>
    <div class="relative rounded-b-lg text-sm flex flex-col gap-y-1 bg-white p-2">

      <div class="flex flex-row gap-4 items-baseline">
        <%= icon('fa-solid', 'hand-holding-heart') %>
        <%= number_to_currency(@amount.to_f / 100, unit: '‚Ç¨', format: '%n %u', delimiter: ' ') %>
      </div>

      <div class="flex flex-row gap-4 items-baseline">
        <%= icon("fa-solid", "paper-plane") %>
        <%= @place.name.titleize %>
      </div>

      <div class="flex flex-row gap-4 items-baseline">
        <%= icon("fa-solid", "location-dot") %>
        <%= @place.street_no %> <%= @place.address %>, <%= @place.city %> <%= @place.zip_code %>, <%= @place.country %>
      </div>

      <div class="flex flex-row gap-4 items-baseline">
        <%= icon("fa-solid", "bullhorn") %>
        <p class="text-justify">
        Merci pour vote g√©n√©rosit√©. Gr√¢ce √† vous, nous pouvons continuer √† assurer notre mission. Au plaisir de vous revoir bient√¥t
        </p>
      </div>

      <%# ajouter en fav %>
      <% if @donator.first_name != 'visiteur' %>
        <div class="absolute top-2 right-2">
          <%= render partial:"favorites/favorite_icon", locals: { donator: @donator, place: @place, favorite: @favorite } %>
        </div>
      <% end %>

    </div>

  </div>

  <%# payment details w/ breakdown %>

  <%# CTA %>
  <div data-controller="convertion-visitor">
    <% if @donator.first_name == 'visiteur' %>
      <div class="mt-2 flex justify-center">
        <h1 class="text-lg font-medium tracking-wider">Ne perdez pas votre don !</h1>
      </div>

      <div class="mb-2 p-2 flex flex-col gap-y-3 text-center text-sm text-inherit opacity-80 roboto-light">
        <p>Devenez un <strong>DoGooder</strong> et suivez toutes vos bonnes actions depuis votre tableau de bord.</p>
        <p>Profitez de la <strong>r√©duction d'imp√¥t</strong> en un seul clic gr√¢ce au re√ßu fiscal √† retrouver dans votre espace.</p>
        <p>Vivez une exp√©rience nouvelle √† travers vos bonnes actions avec DoGood.</p>
      </div>

      <%# form %>
      <div class="pt-2 w-full rounded-lg bg-white shadow-[0_0_12px_1px_rgba(0,0,0,0.1)]">

        <!--
        <div class="flex flex-col items-center justify-center">
          <%= form_for(:user, :url => registration_path(:user), html: { method: :put }) do |f| %>

            <%= f.text_field :last_name, autofocus: true, value: @checkout_session.customer_details.name.split(' ')[1]%>

            <%= f.text_field :first_name, autofocus: true, value: @checkout_session.customer_details.name.split(' ')[0]%>

            <%= f.text_field :email, autofocus: true, value: @checkout_session.customer_details.email %>

            <% if devise_mapping.confirmable? && resource.pending_reconfirmation? %>
              <div>Currently waiting confirmation for: <%= resource.unconfirmed_email %></div>
            <% end %>

            <div>
              <%= f.password_field :password, autocomplete: "new-password" %>
              <% if @minimum_password_length %>
                <br />
                <em><%= @minimum_password_length %> characters minimum</em>
              <% end %>
            </div>

            <%= f.password_field :password_confirmation, autocomplete: "new-password" %>

            <div class="field hidden">
              <%= f.password_field :current_password, value: '654321' %>
            </div>

            <%= f.submit 'Enregistrer' %>
          <% end %>
        </div>
        -->

        <form class="max-w-md mx-auto p-4" action="<%= registration_path(:user) %>" method="PUT" remote="true" data-action="submit->convertion-visitor#newUser">
          <div class="relative z-0 w-full mb-5 group">
              <input type="email" value="<%= @checkout_session.customer_details.email %>" id="floating_email" class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none focus:outline-none focus:ring-0 focus:border-blue-600 peer" placeholder=" " required />
              <label for="floating_email" class="peer-focus:font-medium absolute text-sm text-gray-500  duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto peer-focus:text-blue-600  peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Email address</label>
          </div>
          <div class="grid md:grid-cols-2 md:gap-6">
            <div class="relative z-0 w-full mb-5 group">
              <input type="text" name="user[first_name]" id="first_name" value="<%= @checkout_session.customer_details.name.split(' ')[0].capitalize %>" class="block py-2.5 px-0 w-full text-sm text-black bg-transparent border-0 border-b-2 border-gray-300 appearance-none focus:outline-none focus:ring-0 focus:border-blue-600 peer" placeholder=" " required />
                <label for="first_name" class="peer-focus:font-medium absolute text-sm text-gray-500 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 peer-focus:text-blue-600 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">First name</label>
            </div>
            <div class="relative z-0 w-full mb-5 group">
                <input type="text" name="user[last_name]" id="last_name" value="<%= @checkout_session.customer_details.name.split(' ')[1].capitalize %>" class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none focus:outline-none focus:ring-0 focus:border-blue-600 peer" placeholder=" " required />
                <label for="last_name" class="peer-focus:font-medium absolute text-sm text-gray-500 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 peer-focus:text-blue-600 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Last name</label>
            </div>
          </div>
          <div class="relative z-0 w-full mb-5 group">
              <input type="password" name="user[password]" id="password" class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none focus:outline-none focus:ring-0 focus:border-blue-600 peer" placeholder=" " required />
              <label for="password" class="peer-focus:font-medium absolute text-sm text-gray-500 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 peer-focus:text-blue-600 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Password</label>
          </div>
          <div class="relative z-0 w-full mb-5 group">
              <input type="password" name="user[password_confirmation]" id="password_confirmation" class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none focus:outline-none focus:ring-0 focus:border-blue-600 peer" placeholder=" " required />
              <label for="password_confirmation" class="peer-focus:font-medium absolute text-sm text-gray-500 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 peer-focus:text-blue-600 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Confirm password</label>
              <input type="hidden" name="user[current_password]" id="current_password" value="654321"/>
          </div>
          <button type="submit" class="text-white tracking-wider bg-black hover:bg-black focus:ring-4 focus:outline-none focus:ring-black font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center">Enregistrer</button>
        </form>

      </div>
    <% end %>
  </div>


  <%# feedback and contact %>
  <div class="flex flex-col items-center justify-center">

    <h1 class="mt-2 text-lg font-medium tracking-wider">Notez votre exp√©rience</h1>

    <p class="mb-2 text-sm text-center text-inherit opacity-80 roboto-light">Votre avis contribuera √† notre am√©lioration continue pour rendre votre exp√©rience meilleur.</p>

    <% if @donation.review %>
      <%= render partial: "reviews/thanks" %>
    <% else %>
      <div class="flex flex-col items-center gap-y-2" data-controller="star-rating">
        <div class="flex">
          <% 5.times do %>
            <button class="px-1" data-star-rating-target="star" data-action="click->star-rating#rate">
              <%= svg_tag("star", class: "size-9 text-gray-300") %>
            </button>
          <% end %>
        </div>

        <div class="text-sm text-center text-inherit opacity-80 roboto-light" data-star-rating-target="message"></div>

        <div class="flex gap-2 mt-2" >

          <button disabled class="flex-auto w-20 text-sm px-3 py-2 rounded-lg bg-black disabled:opacity-25" data-star-rating-target="commentBtnOpen" data-action="click->star-rating#openComment">
            <%= icon('fa-solid', 'comment', class:'fa-xl', style:'color: white;') %>
          </button>

          <form action="POST" url="/reviews" class="flex flex-col justify-center items-center gap-y-2"
                                              data-action="submit->star-rating#sendReview">
            <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
            <input type="hidden" name="review[donation_id]" value="<%= @donation.id %>">
            <input type="hidden" name="review[rating]" data-star-rating-target="ratingForm">
            <textarea data-star-rating-target="commentForm" class="rounded-lg hidden" type="text" name="review[content]" cols="40" rows="3" name="review[content]"></textarea>

            <button disabled type="submit" class="flex-auto text-sm px-3 py-2 rounded-lg bg-black text-white tracking-wider w-20 disabled:opacity-25"
                                          data-star-rating-target="submitBtnOpen">
              Envoyer
            </button>
          </form>

        </div>

      </div>
    <% end %>

  </div>

</div>

<%# fixed links %>
<div class="fixed inset-x-0 bottom-0 px-5 py-5 bg-white shadow">
  <div class="flex flex-col gap-4 justify-center items-center text-white text-center text-md tracking-wide">
    <% if @donator.first_name == 'visiteur' %>
      <%= link_to "Cr√©er mon compte",  edit_user_registration_path(:user), class: "flex-auto px-3 py-2 rounded-lg bg-black w-full " %>
    <% else %>
      <%= link_to "Home", donator_root_path(@donator), class: "flex-auto px-3 py-2 rounded-lg bg-black w-full " %>
    <% end %>

    <div class="w-full" data-controller="clipboard" >
      <button class="flex justify-center items-center gap-4 px-3 py-2 rounded-lg text-black bg-gray-200 w-full" value="0786415817" data-action="clipboard#copy" data-clipboard-target="source">
        Nous contacter
        <%= icon('fa-solid', 'headset', class:'fa-xl') %>
      </button>
    </div>
  </div>
</div>
